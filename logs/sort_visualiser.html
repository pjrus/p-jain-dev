<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Step-by-Step Sort Visualizer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      max-width: 600px;
    }
    input, button {
      font-size: 1rem;
      padding: 6px;
      margin: 4px 0;
    }
    #output {
      background: #f4f4f4;
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 10px;
      height: 100px;
      overflow: hidden;
      white-space: pre-wrap;
    }
    #stepControls {
      display: none;
      margin-top: 10px;
    }
    #stepControls button {
      margin-right: 8px;
    }
    .highlight {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Step-by-Step Sort Visualizer</h1>

  <label for="listInput">Enter list:</label><br/>
  <input id="listInput" type="text" placeholder="[5,3,8,1,2]" size="30"/>

  <div id="algoButtons">
    <button id="selBtn">Selection Sort</button>
    <button id="insBtn">Insertion Sort</button>
    <button id="bubBtn">Bubble Sort</button>
    <button id="clearBtn">Clear</button>
  </div>

  <div id="output"></div>

  <div id="stepControls">
    <button id="prevStepBtn">◀ Prev</button>
    <button id="nextStepBtn">Next ▶</button>
    <button id="finishStepBtn">Finish</button>
  </div>

  <script>
    function parseList(str) {
      const clean = str.replace(/\s+/g, '');
      if (!/^\[\-?\d+(\,\-?\d+)*\]$/.test(clean)) {
        throw new Error('Input must look like [n,n,n,...]');
      }
      return clean.slice(1,-1).split(',').map(x=>Number(x));
    }

    let snapshots = [], stepIndex = 0;
    const outputEl = document.getElementById('output');
    const stepControls = document.getElementById('stepControls');
    const prevBtn = document.getElementById('prevStepBtn');
    const nextBtn = document.getElementById('nextStepBtn');
    const finishBtn = document.getElementById('finishStepBtn');
    const selBtn = document.getElementById('selBtn');
    const insBtn = document.getElementById('insBtn');
    const bubBtn = document.getElementById('bubBtn');
    const clearBtn = document.getElementById('clearBtn');
    const algoButtons = [selBtn, insBtn, bubBtn];

    function enterStepMode() {
      stepIndex = 0;
      algoButtons.forEach(b => b.disabled = true);
      showStep();
      stepControls.style.display = 'block';
    }
    function exitStepMode(finished = false) {
      stepControls.style.display = 'none';
      algoButtons.forEach(b => b.disabled = false);
      if (finished) {
        const lastArr = snapshots[snapshots.length - 1].arr;
        outputEl.innerHTML = 
          `Finished sorting<br>` +
          `Sorted list: [${ lastArr.map(n=>n).join(', ') }]`;
      }
    }
    function showStep() {
      const { desc, arr, highlights } = snapshots[stepIndex];
      // build HTML for array with highlighted indices
      const htmlArray = '[' +
        arr.map((n,i) => 
          highlights.includes(i)
            ? `<span class="highlight">${n}</span>`
            : n
        ).join(', ') +
      ']';
      outputEl.innerHTML = 
        `Step ${stepIndex+1}/${snapshots.length}: ${htmlArray}<br>` +
        `${desc}`;
    }

    prevBtn.onclick = () => {
      if (stepIndex > 0) {
        stepIndex--;
        showStep();
      }
    };
    nextBtn.onclick = () => {
      if (stepIndex < snapshots.length - 1) {
        stepIndex++;
        showStep();
      } else {
        exitStepMode(true);
      }
    };
    finishBtn.onclick = () => {
      exitStepMode(true);
    };
    clearBtn.onclick = () => {
      snapshots = [];
      stepIndex = 0;
      exitStepMode();
      outputEl.textContent = '';
      document.getElementById('listInput').value = '';
    };

    function genSelectionSnapshots(arr0) {
      const arr = arr0.slice(), snaps = [];
      for (let i = 0; i < arr.length - 1; i++) {
        let minIdx = i;
        for (let j = i + 1; j < arr.length; j++)
          if (arr[j] < arr[minIdx]) minIdx = j;
        if (minIdx !== i) {
          [arr[i], arr[minIdx]] = [arr[minIdx], arr[i]];
          snaps.push({
            arr: arr.slice(),
            desc: `swapped indices ${i}↔${minIdx}`,
            highlights: [i, minIdx]
          });
        }
      }
      if (snaps.length === 0)
        snaps.push({ arr, desc: '(already sorted)', highlights: [] });
      return snaps;
    }

    function genInsertionSnapshots(arr0) {
      const arr = arr0.slice(), snaps = [];
      for (let i = 1; i < arr.length; i++) {
        const key = arr[i];
        let j = i - 1;
        while (j >= 0 && arr[j] > key) {
          arr[j + 1] = arr[j];
          j--;
        }
        arr[j + 1] = key;
        snaps.push({
          arr: arr.slice(),
          desc: `inserted ${key} at pos ${j+1}`,
          highlights: [i, j+1]
        });
      }
      if (snaps.length === 0)
        snaps.push({ arr, desc: '(already sorted)', highlights: [] });
      return snaps;
    }

    function genBubbleSnapshots(arr0) {
      const arr = arr0.slice(), snaps = [];
      for (let end = arr.length - 1; end > 0; end--) {
        let swapped = false;
        for (let j = 0; j < end; j++) {
          if (arr[j] > arr[j + 1]) {
            [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];
            swapped = true;
            snaps.push({
              arr: arr.slice(),
              desc: `swapped indices ${j}↔${j+1}`,
              highlights: [j, j+1]
            });
          }
        }
        if (!swapped) break;
      }
      if (snaps.length === 0)
        snaps.push({ arr, desc: '(already sorted)', highlights: [] });
      return snaps;
    }

    selBtn.onclick = () => {
      try {
        snapshots = genSelectionSnapshots(parseList(document.getElementById('listInput').value));
        enterStepMode();
      } catch (e) { alert(e.message); }
    };
    insBtn.onclick = () => {
      try {
        snapshots = genInsertionSnapshots(parseList(document.getElementById('listInput').value));
        enterStepMode();
      } catch (e) { alert(e.message); }
    };
    bubBtn.onclick = () => {
      try {
        snapshots = genBubbleSnapshots(parseList(document.getElementById('listInput').value));
        enterStepMode();
      } catch (e) { alert(e.message); }
    };
  </script>
</body>
</html>
